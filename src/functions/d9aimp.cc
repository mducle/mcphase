/*-----------------------------------------------------------------------------*\
| Matpack special functions - Airy modulus and phase                  d9aimp.cc |
|                                                                               |
| MatPack Library Release 1.0                                                   |
| Copyright (C) 1991,1995 by Berndt M. Gammel                                   |
|                                                                               |
| Permission to  use, copy, and  distribute  Matpack  in  its entirety  and its |
| documentation  for non-commercial purpose and  without fee is hereby granted, |
| provided that this license information and copyright notice appear unmodified |
| in all copies.  This software is provided 'as is'  without express or implied |
| warranty.  In no event will the author be held liable for any damages arising |
| from the use of this software.						|
| Note that distributing Matpack 'bundled' in with any product is considered to |
| be a 'commercial purpose'.							|
| The software may be modified for your own purposes, but modified versions may |
| not be distributed without prior consent of the author.			|
|                                                                               |
| Read the  COPYRIGHT and  README files in this distribution about registration	|
| and installation of Matpack.							|
|                                                                               |
\*-----------------------------------------------------------------------------*/

#include "../../include/mpspecfunp.h"

//-----------------------------------------------------------------------------//
//
// void d9aimp (double x, double& ampl, double& theta)
//
// Evaluate the Airy modulus and phase for x <= -1.0 
//
// This is a translation from the Fortran version of SLATEC, FNLIB,
// CATEGORY C10D,  REVISION 900720, originally written by Fullerton W.,(LANL)
// to C++.
//
//
// Series for AM20       on the interval -1.56250E-02 to  0. 
//                                        with weighted error   3.12E-32 
//                                         log weighted error  31.51 
//                               significant figures required  29.24 
//                                    decimal places required  32.38 
//
// Series for ATH0       on the interval -1.56250E-02 to  0. 
//                                        with weighted error   2.75E-32 
//                                         log weighted error  31.56 
//                               significant figures required  30.17 
//                                    decimal places required  32.42 
//
// Series for AM21       on the interval -1.25000E-01 to -1.56250E-02 
//                                        with weighted error   3.40E-32 
//                                         log weighted error  31.47 
//                               significant figures required  29.02 
//                                    decimal places required  32.36 
//
// Series for ATH1       on the interval -1.25000E-01 to -1.56250E-02 
//                                        with weighted error   2.94E-32 
//                                         log weighted error  31.53 
//                               significant figures required  30.08 
//                                    decimal places required  32.41 
//
// Series for AM22       on the interval -1.00000E+00 to -1.25000E-01 
//                                        with weighted error   3.76E-32 
//                                         log weighted error  31.42 
//                               significant figures required  29.47 
//                                    decimal places required  32.36 
//
// Series for ATH2       on the interval -1.00000E+00 to -1.25000E-01 
//                                        with weighted error   4.97E-32 
//                                         log weighted error  31.30 
//                               significant figures required  29.79 
//                                    decimal places required  32.23 
//
//-----------------------------------------------------------------------------//

void d9aimp(double x, double& ampl, double& theta)
{
    static double am20cs[57] = { 
	0.0108716749086561856615730588125,
	3.69489228982663555091728665146e-4,
	4.40680100484689563667507001327e-6,
	1.43686762361911153929183952833e-7,
	8.24275552390078308670628855353e-9,
	6.8442675889366160617392727818e-10,
	7.39566697282739287731004740213e-11,
	9.74595633696825017638702600847e-12,
	1.50076885829405775650973119497e-12,
	2.62147910221527634206252854802e-13,
	5.08354111376487180357278966914e-14,
	1.0768475335881144049298599707e-14,
	2.46091286618433429335914062617e-15,
	6.0078638035865641843611037355e-16,
	1.55449156102388071150651388384e-16,
	4.23535125035576604426382780182e-17,
	1.20862166289299840154401109189e-17,
	3.59609651214658240861499706423e-18,
	1.11134218386395638261774604677e-18,
	3.55559532432366609893680289225e-19,
	1.17433021600139309998766947387e-19,
	3.99397454661077561389162200966e-20,
	1.3957667152891631042560632564e-20,
	5.00240055309236041393459280716e-21,
	1.83552760958132679184834866457e-21,
	6.88490998179202743197790112404e-22,
	2.63631035611417012359996885105e-22,
	1.02924890237338360287153563785e-22,
	4.09246966671594885489762960571e-23,
	1.65558573406734651039727903828e-23,
	6.80797467063033356116599685727e-24,
	2.84326559934079832419751134476e-24,
	1.20507398348965255097287818819e-24,
	5.17961243287505217976613610424e-25,
	2.25622613427562816303268640887e-25,
	9.95418801147745168832117078246e-26,
	4.44551696397342424308280582053e-26,
	2.00865195461501101425916097338e-26,
	9.17786344151775165973885645402e-27,
	4.23872958105589240661672197948e-27,
	1.9778927200784609237084625149e-27,
	9.32116351284620665680435253373e-28,
	4.43482133249918099955611379722e-28,
	2.12945672365573895594589552837e-28,
	1.03158569651075977552209344907e-28,
	5.04023773022591199157904590029e-29,
	2.48301304570155945304046541005e-29,
	1.2330178312856219605419823856e-29,
	6.17033449920521746121976730507e-30,
	3.11092617415918897233869792213e-30,
	1.57983085201706173015269071503e-30,
	8.07931987538283607678121339092e-31,
	4.15997394138667562722951360052e-31,
	2.15610934097716900471935862504e-31,
	1.12468857265869178296752823613e-31,
	5.90331560632838091123040811797e-32,
	3.11735667692928562046280505333e-32 
    };

    static double ath0cs[53] = { 
	-0.08172601764161634499840208700543,
	-8.004012824788273287596481113068e-4,
	-3.186525268782113203795553628242e-6,
	-6.688388266477509330741698865033e-8,
	-2.931759284994564516506822463184e-9,
	-2.011263760883621669049030307186e-10,
	-1.877522678055973426074008166652e-11,
	-2.199637137704601251899002199848e-12,
	-3.071616682592272449025746605586e-13,
	-4.936140553673418361025600985389e-14,
	-8.902833722583660416935236969866e-15,
	-1.768987764615272613656814199467e-15,
	-3.8178686890322770146781996096e-16,
	-8.851159014819947594156286509984e-17,
	-2.184818181414365953149677679568e-17,
	-5.700849046986452380599442295119e-18,
	-1.563121122177875392516031795495e-18,
	-4.481437996768995067906688776353e-19,
	-1.337794883736188022044566044098e-19,
	-4.143340036874114453776852445442e-20,
	-1.327263385718805025080481164652e-20,
	-4.385728589128440522215756835955e-21,
	-1.491360695952818067686201743956e-21,
	-5.208104738630711377154238188773e-22,
	-1.864382222390498923872526604979e-22,
	-6.830263751167969012975435381881e-23,
	-2.557117058029329629296207591347e-23,
	-9.770158640254300218246907254046e-24,
	-3.805161433416679084068428254886e-24,
	-1.509022750737054063493926482995e-24,
	-6.087551341242424929005568014525e-25,
	-2.495879513809711495425982124058e-25,
	-1.039157654581920948909588084274e-25,
	-4.390235913976846536974594969051e-26,
	-1.880790678447990211675826820582e-26,
	-8.165070764199462948863022205753e-27,
	-3.589944503749750514266435585041e-27,
	-1.597658126632132872981291608708e-27,
	-7.193250175703823969113802835305e-28,
	-3.274943012727856506209351132721e-28,
	-1.507042445783690665816975047272e-28,
	-7.00662419831990471784396794914e-29,
	-3.289907402983718226528815678356e-29,
	-1.559518084365146526445322711496e-29,
	-7.460690508208254582833851119721e-30,
	-3.600877034824662020563277249431e-30,
	-1.752851437473772257350402219197e-30,
	-8.603275775188512909623778628724e-31,
	-4.256432603226946534668039480105e-31,
	-2.122161865044262927723650698206e-31,
	-1.065996156704879052472060798561e-31,
	-5.393568608816949116410688086892e-32,
	-2.74817485104395482227849651787e-32 
    };

    static double am21cs[60] = { 
	0.00592790266721309588375717482814,
	0.0020056940539316518642869521769,
	9.11081850262275893553072526291e-5,
	8.49894306372047155633172107475e-6,
	1.13297908976913076637929215494e-6,
	1.87517946100666496180950627804e-7,
	3.59306519018245832699035211192e-8,
	7.6575771407168386403909351747e-9,
	1.76999967168039173925953460744e-9,
	4.36259555654598932720546585535e-10,
	1.13291641337853230035520085219e-10,
	3.07257690982419244137868398126e-11,
	8.64482416482201075541200465766e-12,
	2.51015250060924402115104562212e-12,
	7.49102496764440371601802227751e-13,
	2.28996928487994073089565214432e-13,
	7.15113658927987694949327491175e-14,
	2.27607924959566841946395165061e-14,
	7.36942142760886513969953227782e-15,
	2.42328675267827490463991742006e-15,
	8.08153774548239869283406558403e-16,
	2.73008079804356086659174563386e-16,
	9.33236070891385318473519474326e-17,
	3.22508099681084622213867546973e-17,
	1.12581932346444541217757573416e-17,
	3.9669946398693882166025945953e-18,
	1.41006567944319504660865034527e-18,
	5.05302086537851213375537393032e-19,
	1.82461523215945141197999102789e-19,
	6.63584568262130466928029121642e-20,
	2.42963731631276179741747455826e-20,
	8.95238915123687802013669922963e-21,
	3.31845289350050791260229250755e-21,
	1.23706196188658315384437905922e-21,
	4.63636677012390840306767734243e-22,
	1.74653135947764475469758765989e-22,
	6.61116810234991176307910643111e-23,
	2.51409918994072486176125666459e-23,
	9.60274995571732568694034386998e-24,
	3.68324952289296395686436898078e-24,
	1.41843138269159136145535939553e-24,
	5.4834267427693583010634580099e-25,
	2.12761054623118806650372562616e-25,
	8.28443700849418591487734760953e-26,
	3.23670563926127001421028600927e-26,
	1.26868882963286057355055062493e-26,
	4.98843818992121626935068934362e-27,
	1.9673458446764939096711938179e-27,
	7.78135971020326957713212064836e-28,
	3.08633941498911152919192968451e-28,
	1.22744647045453119789338037234e-28,
	4.89431279134292205885241216204e-29,
	1.95646879802909821175925099724e-29,
	7.83988952922426171166311492266e-30,
	3.14896914002484223748298978099e-30,
	1.26769763137250681307067842559e-30,
	5.11470691906900141641632107724e-31,
	2.06801709795538770250900316706e-31,
	8.37891344768519001325996867583e-32,
	3.40168991971489802052339079577e-32 
    };

    static double ath1cs[58] = { 
	-0.06972849916208883845888148415037,
	-0.005108722790650044987073448077961,
	-8.644335996989755094525334749512e-5,
	-5.604720044235263542188698916125e-6,
	-6.045735125623897409156376640077e-7,
	-8.639802632488334393219721138499e-8,
	-1.48080948430992715714778248078e-8,
	-2.885809334577236039999449908712e-9,
	-6.1916319756656996093091912318e-10,
	-1.431992808860957830931365259879e-10,
	-3.518141102137214721504616874321e-11,
	-9.084761919955078290070339808051e-12,
	-2.446171672688598449343283664767e-12,
	-6.826083203213446240828996710264e-13,
	-1.964579931194940171278546257802e-13,
	-5.808933227139693164009191265856e-14,
	-1.759042249527441992795400959024e-14,
	-5.440902932714896613632538945319e-15,
	-1.715247407486806802622358519451e-15,
	-5.500929233576991546871101847161e-16,
	-1.791878287739317259495152638754e-16,
	-5.920372520086694197778411062231e-17,
	-1.98171302787648396247097220659e-17,
	-6.71323234701635226204998434379e-18,
	-2.299450243658281116122358619832e-18,
	-7.957300928236376595304637145634e-19,
	-2.779994027291784157172290233739e-19,
	-9.798924361326985224406795480814e-20,
	-3.482717006061574386702645565849e-20,
	-1.247489122558599057173300058084e-20,
	-4.501210041478228113487751824452e-21,
	-1.635346244013352135596114164667e-21,
	-5.980102897780336268098762265941e-22,
	-2.200246286286123454028196295475e-22,
	-8.142463073515085897408205291519e-23,
	-3.029924773660042537432330709674e-23,
	-1.133390098574623537722943969689e-23,
	-4.260766024749295719283049889791e-24,
	-1.609363396278189718797500634453e-24,
	-6.106377190825026293045330444287e-25,
	-2.326954318021694061836577887573e-25,
	-8.903987877472252604474129558186e-26,
	-3.420558530005675024117914752341e-26,
	-1.319026715257272659017212100607e-26,
	-5.104899493612043091316191177386e-27,
	-1.982599478474547451242444663466e-27,
	-7.725702356880830535636111851519e-28,
	-3.020234733664680100815776863573e-28,
	-1.1843797390741699937129463808e-28,
	-4.658430227922308520573252840106e-29,
	-1.837554188100384647157502006613e-29,
	-7.2685668944279909533218766848e-30,
	-2.882863120391468135527089875626e-30,
	-1.146374629459906350417591664639e-30,
	-4.570031437748533058179991688533e-31,
	-1.826276602045346104809934028799e-31,
	-7.315349993385250469111066350933e-32,
	-2.936925599971429781637815773866e-32 
    };

    static double am22cs[74] = { 
	-0.0156284448062534112753545828583,
	0.00778336445239681307018943100334,
	8.6705777047718952840607281211e-4,
	1.56966273156113719469953482266e-4,
	3.56396257143286511324100666302e-5,
	9.24598335425043154495080090994e-6,
	2.62110161850422389523194982066e-6,
	7.91882216516012561489469982263e-7,
	2.51041527921011847803162690862e-7,
	8.2652232066540773447299771294e-8,
	2.80571166281305264396384290014e-8,
	9.7682109048468078667463127389e-9,
	3.47407923227710343287279035573e-9,
	1.25828132169836914219092738164e-9,
	4.62988260641895264497330784625e-10,
	1.72728258813604072468143128696e-10,
	6.5231920013115413514857412497e-11,
	2.49047168520982056019881087112e-11,
	9.60156820553765948078189890126e-12,
	3.73448002067726856974776596757e-12,
	1.46417565032053391722216189678e-12,
	5.78265471168512825475827881553e-13,
	2.29915407244706118560254184494e-13,
	9.19780711231997257150883662365e-14,
	3.70060068813090065807504045556e-14,
	1.49675761698672987823326345205e-14,
	6.08361194938461148720451399443e-15,
	2.48404087115121397635425326873e-15,
	1.01862476526769080727914465339e-15,
	4.19383856352753989429640310957e-16,
	1.73318901762930756149702493501e-16,
	7.18821902388508517820445406811e-17,
	2.99123633598403607712470896113e-17,
	1.2486899043323862785571311088e-17,
	5.22829344609483661928651193632e-18,
	2.19532961724713396595998454359e-18,
	9.24298325229777281154410024332e-19,
	3.90157708236091407825543197309e-19,
	1.65093892693863707213759030367e-19,
	7.00221815715994367565716554487e-20,
	2.97651833616786915573214963506e-20,
	1.26796539086902072571134261229e-20,
	5.41243400697077628687581725061e-21,
	2.31487350218155252296382133283e-21,
	9.91920288386566563462623851167e-22,
	4.25803015323732357158897608174e-22,
	1.83101842973024501678402003088e-22,
	7.88678712311075375564526811022e-23,
	3.40254607386229874956582997235e-23,
	1.47020881405712530791860892535e-23,
	6.36211018324916957733348071767e-24,
	2.75707050680980721919395987768e-24,
	1.19645858090104071356261780457e-24,
	5.19912545729242147981768210567e-25,
	2.2621767484710447526057528685e-25,
	9.85526113754431819448565068283e-26,
	4.29870630332508717223681286187e-26,
	1.87723641661580639829657670189e-26,
	8.20721941772842137268801052115e-27,
	3.59214665604615507812767944463e-27,
	1.57390594612773315611458940587e-27,
	6.90329781039333834965319153586e-28,
	3.03092079078968534607859331415e-28,
	1.33204934160481219185689121944e-28,
	5.85978836851523490117937981442e-29,
	2.58016868489487806338425080457e-29,
	1.13712433637283667223632182863e-29,
	5.01592557226068509236430548549e-30,
	2.21445829395509373322569708484e-30,
	9.78470283886507289984691416411e-31,
	4.32695414934180170112000952983e-31,
	1.9149728819399457061292986044e-31,
	8.48164622402392354171298331562e-32,
	3.75947065173955919947455052934e-32 
    };

    static double ath2cs[72] = { 
	 0.004405273458718778997061127057775,
	-0.03042919452318454608483844239873,
	-0.001385653283771793791602692842653,
	-1.804443908954952302670486910952e-4,
	-3.380847108327308671057465323618e-5,
	-7.678183535229023055257676817765e-6,
	-1.967839443716035324690935417077e-6,
	-5.483727115877700361586143659281e-7,
	-1.625461550532612452712696212258e-7,
	-5.053049981268895015277637842078e-8,
	-1.631580701124066881183851715617e-8,
	-5.434204112348517507963436694817e-9,
	-1.85739855640990032576385010963e-9,
	-6.489512033326108816213513640676e-10,
	-2.310594885800944720482995987079e-10,
	-8.363282183204411682819329546745e-11,
	-3.071196844890191462660661303891e-11,
	-1.142367142432716819409514579892e-11,
	-4.298116066345803065822470108971e-12,
	-1.633898699596715440601646086632e-12,
	-6.269328620016619432123443754076e-13,
	-2.426052694816257357356159203991e-13,
	-9.461198321624039090742527765052e-14,
	-3.716060313411504806847798281269e-14,
	-1.469155684097526763170138810309e-14,
	-5.843694726140911944556401363094e-15,
	-2.337502595591951298832675034934e-15,
	-9.399231371171435401160167358411e-16,
	-3.798014669372894500076335263715e-16,
	-1.541731043984972524883443681775e-16,
	-6.285287079535307162925662365202e-17,
	-2.572731812811455424755383992774e-17,
	-1.057098119354017809340974866555e-17,
	-4.359080267402696966695992699964e-18,
	-1.80363431595997801395317694554e-18,
	-7.486838064380536821719431676914e-19,
	-3.117261367347604656799597209985e-19,
	-1.301687980927700734792871620696e-19,
	-5.450527587519522468973883909909e-20,
	-2.288293490114231872268635931903e-20,
	-9.631059503829538655655060440088e-21,
	-4.063281001524614089092195416434e-21,
	-1.71820398090802676390041385851e-21,
	-7.281574619892536367415322473328e-22,
	-3.09235265268064312796068034579e-22,
	-1.315917855965440490383417023254e-22,
	-5.610606786087055512664907412668e-23,
	-2.396621894086355206020304337895e-23,
	-1.025574332390581200832954423924e-23,
	-4.396264138143656476403607323663e-24,
	-1.88765299837257737334250871945e-24,
	-8.118140359576807603579433230445e-25,
	-3.496734274366286856375952089214e-25,
	-1.508402925156873215171751475867e-25,
	-6.516268284778671059787773834341e-26,
	-2.818945797529207424505942114583e-26,
	-1.221127596512262744598094464505e-26,
	-5.296674341169867168620011705073e-27,
	-2.300359270773673431358870971744e-27,
	-1.00027948235536749478122034893e-27,
	-4.354760404180879394806893162179e-28,
	-1.89805613474147752251548282703e-28,
	-8.282111868712974697554009309315e-29,
	-3.617815493066569006586213484374e-29,
	-1.582018896178003654858941843636e-29,
	-6.925068597802270011772820383247e-30,
	-3.034390239778629128908629727335e-30,
	-1.330889568166725224761977446509e-30,
	-5.842848522173090120487606971706e-31,
	-2.567488423238302631121274357678e-31,
	-1.129232322268882185791505819151e-31,
	-4.970947029753336916550570105023e-32 
    };

    const double pi4  = 0.78539816339744830961566084581988,
	         eta  = 0.5 * DBL_EPSILON * 0.1,
	         xsml = -1.0 / pow(0.5 * DBL_EPSILON, 0.3333);

    static int nam20, nath0, nam21, nath1, nam22, nath2, first = 1;
    if (first) {
	nam20 = initds(am20cs, 57, eta);
	nath0 = initds(ath0cs, 53, eta);
	nam21 = initds(am21cs, 60, eta);
	nath1 = initds(ath1cs, 58, eta);
	nam22 = initds(am22cs, 74, eta);
	nath2 = initds(ath2cs, 72, eta);
	first = 0;
    }

    double z, sqrtx;

    if (x >= -4.0) goto L20;
    z = 1.0;
    if (x > xsml) z = 128.0 / (x * x * x) + 1.0;
    ampl  = dcsevl(z, am20cs, nam20) + 0.3125;
    theta = dcsevl(z, ath0cs, nath0) - 0.625;
    goto L40;

  L20:
    if (x >= -2.0) goto L30;
    z = (128.0 / (x * x * x) + 9.0) / 7.0;
    ampl  = dcsevl(z, am21cs, nam21) + 0.3125;
    theta = dcsevl(z, ath1cs, nath1) - 0.625;
    goto L40;

  L30:
    if (x >= -1.0) {
	Matpack.Error(Mat::ArgumentDomain, "%s: %s", "d9aimp", 
		      "x must be < -1.0");
	ampl = theta = NAN;
	return;
    }
    z = (16.0 / (x * x * x) + 9.0) / 7.0;
    ampl  = dcsevl(z, am22cs, nam22) + 0.3125;
    theta = dcsevl(z, ath2cs, nath2) - 0.625;

  L40:
    sqrtx = sqrt(-x);
    ampl = sqrt(ampl / sqrtx);
    theta = pi4 - x * sqrtx * theta;
}

//-----------------------------------------------------------------------------//
